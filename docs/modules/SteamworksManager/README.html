<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>SteamworksManager </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="SteamworksManager ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/EndlessShirafu/VaNilla/blob/develop/Documents/docfx/modules/SteamworksManager/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="steamworksmanager">SteamworksManager</h1>

<p>Steam プラットフォームとの包括的な連携機能を提供するVaNillaモジュールです。
実績システム、リーダーボード、ユーザー認証など、Steamworksの主要機能を
統一されたAPIで利用できます。</p>
<h2 id="概要">概要</h2>
<p>SteamworksManagerは、Steamプラットフォーム上でゲームを配信する際に必要な
様々な機能を簡単に利用できるようにするラッパーモジュールです。
Steamworks.NETライブラリをベースに、VaNillaアプリケーションで使いやすい
高レベルAPIを提供します。</p>
<h2 id="主要機能">主要機能</h2>
<h3 id="steam-プラットフォーム統合">Steam プラットフォーム統合</h3>
<ul>
<li><strong>SteamManager</strong>: Steam API の初期化と基本管理</li>
<li><strong>AchievementManager</strong>: 実績システムの管理</li>
<li><strong>RankingManager</strong>: リーダーボード機能</li>
<li><strong>ユーザー認証</strong>: Steam ユーザーとの連携</li>
</ul>
<h3 id="対応機能一覧">対応機能一覧</h3>
<table>
<thead>
<tr>
<th>機能カテゴリ</th>
<th>機能</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>認証・ユーザー</strong></td>
<td>ユーザー情報取得</td>
<td>Steam ユーザー名の取得</td>
</tr>
<tr>
<td><strong>実績</strong></td>
<td>実績解除</td>
<td>Steam 実績の解除・管理</td>
</tr>
<tr>
<td><strong>実績</strong></td>
<td>統計情報</td>
<td>ゲーム統計データの送信</td>
</tr>
<tr>
<td><strong>ランキング</strong></td>
<td>スコア送信</td>
<td>リーダーボードへのスコア投稿</td>
</tr>
<tr>
<td><strong>ランキング</strong></td>
<td>ランキング取得</td>
<td>上位ランキングデータの取得</td>
</tr>
<tr>
<td><strong>システム</strong></td>
<td>DRM サポート</td>
<td>Steam DRM による正当性確認</td>
</tr>
</tbody>
</table>
<h2 id="基本的な使用方法">基本的な使用方法</h2>
<h3 id="steam-の初期化">Steam の初期化</h3>
<pre><code class="lang-csharp">using VaNilla.SteamworksManager;

// Steam の初期化（アプリケーション起動時）
uint steamAppId = 12345; // Steam で割り当てられたアプリID
SteamManager.Initialize(steamAppId);

if (SteamManager.Initialized)
{
    VaNilla.Debug.Logger.Log($&quot;Steam ユーザー: {SteamManager.PlayerName}&quot;);
    
    // 実績マネージャーの初期化
    AchievementManager.Initialize();
    
    // リーダーボードのダウンロード
    RankingManager.DownloadLeaderboard(&quot;HighScore&quot;);
}
</code></pre>
<h3 id="実績システム">実績システム</h3>
<pre><code class="lang-csharp">// 実績の解除
AchievementManager.SetAchievement(&quot;FIRST_VICTORY&quot;);

// 統計データの送信
AchievementManager.SetStatValue(&quot;TOTAL_PLAYTIME&quot;, 3600); // 秒単位

// 実績の状態確認
bool hasAchievement = AchievementManager.GetAchievement(&quot;FIRST_VICTORY&quot;);
if (hasAchievement)
{
    VaNilla.Debug.Logger.Log(&quot;既に獲得済みの実績です&quot;);
}

// 実績の詳細情報取得
string achievementName = AchievementManager.GetAchievementDisplayName(&quot;FIRST_VICTORY&quot;);
string achievementDesc = AchievementManager.GetAchievementDisplayDescription(&quot;FIRST_VICTORY&quot;);
</code></pre>
<h3 id="リーダーボードシステム">リーダーボードシステム</h3>
<pre><code class="lang-csharp">// リーダーボードのダウンロード
RankingManager.DownloadLeaderboard(&quot;HighScore&quot;);

// ダウンロード完了を待つ
while (!RankingManager.IsDownloadedRanking(&quot;HighScore&quot;))
{
    SteamManager.Execute(); // Steam コールバックの処理
    await Task.Delay(100);
}

// ランキングデータの取得
Ranking ranking = RankingManager.GetDownloadedRanking(&quot;HighScore&quot;);
if (ranking != null &amp;&amp; RankingManager.IsDownloadedEntries(ranking))
{
    // 上位100件のスコアを表示
    foreach (var entry in ranking.leaderboardEntries.Values)
    {
        VaNilla.Debug.Logger.Log($&quot;順位: {entry.m_nGlobalRank}, スコア: {entry.m_nScore}&quot;);
    }
}

// スコアの送信
int playerScore = 98765;
RankingManager.UploadScore(ranking, playerScore);
</code></pre>
<h3 id="メインループでの更新処理">メインループでの更新処理</h3>
<pre><code class="lang-csharp">// ゲームのメインループ内で呼び出し
public void Update()
{
    if (SteamManager.Initialized)
    {
        SteamManager.Execute(); // Steam コールバックの処理
    }
}

// アプリケーション終了時
public void OnApplicationQuit()
{
    SteamManager.Finalize();
}
</code></pre>
<h2 id="アーキテクチャ">アーキテクチャ</h2>
<h3 id="モジュール構成">モジュール構成</h3>
<pre><code>SteamworksManager/
├── Interface/              # 公開API
│   ├── SteamManager.cs     # Steam基本管理
│   ├── AchievementManager.cs # 実績管理
│   ├── RankingManager.cs   # ランキング管理
│   └── Ranking.cs          # ランキングデータ構造
├── Dependency/             # 外部ライブラリ
│   ├── Windows-x64/        # 64bit版依存関係
│   └── Windows-x86/        # 32bit版依存関係
└── Test/                   # テストコード
</code></pre>
<h3 id="依存関係">依存関係</h3>
<table>
<thead>
<tr>
<th>ライブラリ</th>
<th>用途</th>
<th>プラットフォーム</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Steamworks.NET.dll</strong></td>
<td>Steam API ラッパー</td>
<td>Windows x86/x64</td>
</tr>
<tr>
<td><strong>steam_api.dll</strong></td>
<td>Steam API (32bit)</td>
<td>Windows x86</td>
</tr>
<tr>
<td><strong>steam_api64.dll</strong></td>
<td>Steam API (64bit)</td>
<td>Windows x64</td>
</tr>
</tbody>
</table>
<h2 id="詳細機能解説">詳細機能解説</h2>
<h3 id="steammanager">SteamManager</h3>
<p>Steam プラットフォームとの基本的な接続と管理を担当します。</p>
<pre><code class="lang-csharp">public static class SteamManager
{
    public static AppId_t SteamGameId { get; }        // Steam アプリID
    public static bool Initialized { get; }           // 初期化状態
    public static string PlayerName { get; }          // プレイヤー名
    
    public static void Initialize(uint steamAppId);   // 初期化
    public static void Execute();                     // コールバック処理
    public static void Finalize();                    // 終了処理
}
</code></pre>
<h3 id="achievementmanager">AchievementManager</h3>
<p>Steam 実績システムの管理を行います。</p>
<pre><code class="lang-csharp">public static class AchievementManager
{
    // 実績解除
    public static void SetAchievement(string achievementName);
    
    // 実績状態取得
    public static bool GetAchievement(string achievementName);
    
    // 実績削除（開発・テスト用）
    public static void ClearAchievement(string achievementName);
    
    // 統計データ送信
    public static void SetStatValue(string stat, int value);
    
    // 実績の表示情報取得
    public static string GetAchievementDisplayName(string achievementName);
    public static string GetAchievementDisplayDescription(string achievementName);
}
</code></pre>
<h3 id="rankingmanager">RankingManager</h3>
<p>Steam リーダーボードシステムの管理を行います。</p>
<pre><code class="lang-csharp">public static class RankingManager
{
    // 取得済みランキングデータ
    public static Dictionary&lt;string, Ranking&gt; ObtainedRankings { get; }
    
    // リーダーボードのダウンロード
    public static void DownloadLeaderboard(string rankingBoardName);
    
    // ダウンロード状態確認
    public static bool IsDownloadedRanking(string rankingBoardName);
    
    // ランキングデータ取得
    public static Ranking GetDownloadedRanking(string rankingBoardName);
    
    // スコア送信
    public static void UploadScore(Ranking ranking, int score);
    
    // エントリ取得
    public static void DownloadEntries(Ranking ranking, int range);
    public static bool IsDownloadedEntries(Ranking ranking);
}
</code></pre>
<h2 id="実装例">実装例</h2>
<h3 id="完全な実績システム実装">完全な実績システム実装</h3>
<pre><code class="lang-csharp">public class GameAchievementSystem
{
    private static readonly Dictionary&lt;string, string&gt; achievements = new Dictionary&lt;string, string&gt;
    {
        {&quot;FIRST_VICTORY&quot;, &quot;初勝利&quot;},
        {&quot;SPEED_RUNNER&quot;, &quot;スピードランナー&quot;},
        {&quot;PERFECTIONIST&quot;, &quot;完璧主義者&quot;}
    };

    public static void UnlockAchievement(string achievementId)
    {
        if (!SteamManager.Initialized) return;
        
        if (achievements.ContainsKey(achievementId))
        {
            AchievementManager.SetAchievement(achievementId);
            VaNilla.Debug.Logger.Log($&quot;実績解除: {achievements[achievementId]}&quot;);
        }
    }

    public static void UpdatePlayTime(int seconds)
    {
        if (!SteamManager.Initialized) return;
        
        AchievementManager.SetStatValue(&quot;TOTAL_PLAYTIME&quot;, seconds);
        
        // プレイ時間に応じた実績解除
        if (seconds &gt;= 3600) // 1時間
        {
            UnlockAchievement(&quot;DEDICATED_PLAYER&quot;);
        }
    }
}
</code></pre>
<h3 id="ランキングシステム実装">ランキングシステム実装</h3>
<pre><code class="lang-csharp">public class GameRankingSystem
{
    private const string HIGHSCORE_BOARD = &quot;HighScore&quot;;
    private Ranking currentRanking;

    public async Task InitializeRanking()
    {
        if (!SteamManager.Initialized) return;

        RankingManager.DownloadLeaderboard(HIGHSCORE_BOARD);
        
        // ダウンロード完了を待機
        while (!RankingManager.IsDownloadedRanking(HIGHSCORE_BOARD))
        {
            SteamManager.Execute();
            await Task.Delay(100);
        }
        
        currentRanking = RankingManager.GetDownloadedRanking(HIGHSCORE_BOARD);
        VaNilla.Debug.Logger.Log($&quot;リーダーボード取得完了: {currentRanking.leaderboardName}&quot;);
    }

    public void SubmitScore(int score)
    {
        if (currentRanking != null)
        {
            RankingManager.UploadScore(currentRanking, score);
            VaNilla.Debug.Logger.Log($&quot;スコア送信: {score}&quot;);
        }
    }

    public List&lt;LeaderboardEntry_t&gt; GetTopScores(int count = 10)
    {
        if (currentRanking == null || !RankingManager.IsDownloadedEntries(currentRanking))
        {
            return new List&lt;LeaderboardEntry_t&gt;();
        }

        return currentRanking.leaderboardEntries.Values
               .OrderBy(entry =&gt; entry.m_nGlobalRank)
               .Take(count)
               .ToList();
    }
}
</code></pre>
<h2 id="セットアップガイド">セットアップガイド</h2>
<h3 id="steam-パートナー設定">Steam パートナー設定</h3>
<ol>
<li>Steam パートナーポータルでアプリケーションを登録</li>
<li>アプリIDを取得（例: 480）</li>
<li>実績とリーダーボードを設定</li>
<li>steamworks SDK をダウンロード</li>
</ol>
<h3 id="開発環境設定">開発環境設定</h3>
<ol>
<li>プロジェクトに Steamworks.NET を追加</li>
<li>steam_appid.txt ファイルを実行ファイルと同じディレクトリに配置</li>
<li>steam_appid.txt にアプリIDを記述</li>
</ol>
<pre><code>// steam_appid.txt の内容例
480
</code></pre>
<h3 id="ビルド設定">ビルド設定</h3>
<ul>
<li>Steamworks 関連DLLを出力ディレクトリにコピー</li>
<li>プラットフォーム（x86/x64）に応じた適切なDLLを使用</li>
</ul>
<h2 id="トラブルシューティング">トラブルシューティング</h2>
<h3 id="よくある問題">よくある問題</h3>
<table>
<thead>
<tr>
<th>問題</th>
<th>原因</th>
<th>解決方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>初期化失敗</td>
<td>Steam クライアントが未起動</td>
<td>Steam を起動してからゲームを実行</td>
</tr>
<tr>
<td>実績が反映されない</td>
<td>ネットワーク接続問題</td>
<td>インターネット接続を確認</td>
</tr>
<tr>
<td>リーダーボードエラー</td>
<td>リーダーボード名の不一致</td>
<td>Steam パートナーポータルで名前を確認</td>
</tr>
<tr>
<td>DLL エラー</td>
<td>不適切なDLLバージョン</td>
<td>プラットフォームに対応したDLLを使用</td>
</tr>
</tbody>
</table>
<h3 id="デバッグ方法">デバッグ方法</h3>
<pre><code class="lang-csharp">// Steam 接続状態の確認
if (!SteamManager.Initialized)
{
    VaNilla.Debug.Logger.LogError(&quot;Steam が初期化されていません&quot;);
    return;
}

// ネットワーク状態の確認
if (!System.Net.NetworkInformation.NetworkInterface.GetIsNetworkAvailable())
{
    VaNilla.Debug.Logger.LogWarning(&quot;ネットワークに接続されていません&quot;);
}

// 詳細ログの有効化（起動オプション）
// -debug_steamapi を追加して詳細ログを出力
</code></pre>
<h2 id="パフォーマンス考慮事項">パフォーマンス考慮事項</h2>
<h3 id="効率的な実装">効率的な実装</h3>
<ul>
<li><strong>コールバック処理</strong>: SteamManager.Execute() は毎フレーム呼び出し</li>
<li><strong>非同期処理</strong>: リーダーボードのダウンロードは非同期で実行</li>
<li><strong>キャッシュ戦略</strong>: 取得したランキングデータをメモリに保持</li>
</ul>
<h3 id="リソース管理">リソース管理</h3>
<ul>
<li>Steam API は適切に初期化・終了処理を実行</li>
<li>メモリリークを防ぐため、不要なコールバックは削除</li>
</ul>
<h2 id="セキュリティ">セキュリティ</h2>
<h3 id="drm-機能">DRM 機能</h3>
<pre><code class="lang-csharp">// Steam DRM による正当性確認
if (SteamAPI.RestartAppIfNecessary(SteamGameId))
{
    // Steam 経由で起動されていない場合、Steam で再起動
    Application.Quit();
}
</code></pre>
<h3 id="データ整合性">データ整合性</h3>
<ul>
<li>実績やスコアデータは Steam サーバーで管理</li>
<li>クライアント側での改ざんは困難</li>
<li>サーバーサイド検証により不正なデータを防止</li>
</ul>
<h2 id="技術仕様">技術仕様</h2>
<ul>
<li><strong>対応プラットフォーム</strong>: Windows (x86, x64)</li>
<li><strong>必要ライブラリ</strong>: Steamworks.NET, Steam API</li>
<li><strong>対応 .NET バージョン</strong>: .NET Framework 4.5+</li>
<li><strong>Steam クライアント</strong>: 必須（ユーザーのPC上）</li>
<li><strong>ネットワーク</strong>: インターネット接続必須</li>
</ul>
<hr>
<p>SteamworksManagerにより、VaNillaアプリケーションでSteamプラットフォームの
豊富な機能を簡単に活用できます。実績、ランキング、ユーザー認証など、
モダンなゲーム体験に必要な機能を統一されたAPIで提供します。</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/EndlessShirafu/VaNilla/blob/develop/Documents/docfx/modules/SteamworksManager/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>RandomNumberGenerator モジュール </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="RandomNumberGenerator モジュール ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/EndlessShirafu/VaNilla/blob/develop/Documents/docfx/modules/RandomNumberGenerator/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="randomnumbergenerator-モジュール">RandomNumberGenerator モジュール</h1>

<p>RandomNumberGeneratorモジュールは、ゲーム開発で必要な乱数生成機能を提供するモジュールです。決定論的な乱数生成により、再現可能なゲームプレイや公平な確率計算を実現します。</p>
<h2 id="概要">概要</h2>
<p>このモジュールは以下の機能を提供します：</p>
<ul>
<li><strong>決定論的乱数生成</strong>: シード値による再現可能な乱数系列</li>
<li><strong>複数データ型対応</strong>: int、float、doubleの乱数生成</li>
<li><strong>範囲指定乱数</strong>: 最小値・最大値を指定した乱数生成</li>
<li><strong>統一インターフェース</strong>: VaNilla.Math.Rangeとの連携</li>
<li><strong>高速生成</strong>: System.Randomベースの効率的な実装</li>
</ul>
<h2 id="実装状況">実装状況</h2>
<p>✅ <strong>完了</strong>: 基本的な乱数生成機能はすべて実装済みです。</p>
<h2 id="主要機能">主要機能</h2>
<h3 id="randomnumbergenerator-クラス">RandomNumberGenerator クラス</h3>
<p>静的クラスとして乱数生成機能を提供します。</p>
<pre><code class="lang-csharp">[VaNillaModuleVersion(0, 0, 1, 0)]
public static class RandomNumberGenerator
{
    // シード値設定
    public static void SetSeedValue(int seed_value);
    
    // 範囲指定乱数生成
    public static float Range(float min_value, float max_value);
    public static double Range(double min_value, double max_value);
    public static int Range(int min_value, int max_value);
    public static float Range(Math.Range range);
    
    // 最大値指定乱数生成
    public static float GetValue(float max_value);
    public static double GetValue(double max_value);
    public static int GetValue(int max_value);
}
</code></pre>
<h2 id="使用方法">使用方法</h2>
<h3 id="基本的な乱数生成">基本的な乱数生成</h3>
<pre><code class="lang-csharp">// シード値の設定（再現可能な乱数系列）
RandomNumberGenerator.SetSeedValue(12345);

// 0〜1の範囲の小数乱数
float randomFloat = RandomNumberGenerator.GetValue(1.0f);

// 0〜99の範囲の整数乱数
int randomInt = RandomNumberGenerator.GetValue(100);

// 指定範囲の乱数生成
float damage = RandomNumberGenerator.Range(10.0f, 20.0f); // 10.0〜19.999...
int level = RandomNumberGenerator.Range(1, 11); // 1〜10
double precise = RandomNumberGenerator.Range(0.0, 1.0); // 0.0〜0.999...
</code></pre>
<h3 id="vanillamathrangeとの連携">VaNilla.Math.Rangeとの連携</h3>
<pre><code class="lang-csharp">// Rangeオブジェクトを使用した乱数生成
var damageRange = new Math.Range(15.0, 25.0);
float damage = RandomNumberGenerator.Range(damageRange);

var levelRange = new Math.Range(1, 10);
float level = RandomNumberGenerator.Range(levelRange);
</code></pre>
<h3 id="ゲーム開発での実用例">ゲーム開発での実用例</h3>
<h4 id="ダメージ計算">ダメージ計算</h4>
<pre><code class="lang-csharp">public class DamageCalculator
{
    public static int CalculateRandomDamage(int baseDamage, float variance = 0.2f)
    {
        float min = baseDamage * (1.0f - variance);
        float max = baseDamage * (1.0f + variance);
        return (int)RandomNumberGenerator.Range(min, max);
    }
}

// 使用例
int playerAttack = 100;
int actualDamage = DamageCalculator.CalculateRandomDamage(playerAttack, 0.15f);
// 85〜115の範囲でランダムなダメージ
</code></pre>
<h4 id="アイテムドロップ判定">アイテムドロップ判定</h4>
<pre><code class="lang-csharp">public class ItemDropSystem
{
    public static bool ShouldDropItem(float dropRate)
    {
        float random = RandomNumberGenerator.GetValue(1.0f);
        return random &lt; dropRate;
    }
    
    public static ItemType GetRandomItem(Dictionary&lt;ItemType, float&gt; dropRates)
    {
        float random = RandomNumberGenerator.GetValue(1.0f);
        float cumulative = 0.0f;
        
        foreach (var kvp in dropRates)
        {
            cumulative += kvp.Value;
            if (random &lt; cumulative)
            {
                return kvp.Key;
            }
        }
        
        return ItemType.None;
    }
}

// 使用例
var dropRates = new Dictionary&lt;ItemType, float&gt;
{
    { ItemType.CommonSword, 0.5f },
    { ItemType.RareSword, 0.3f },
    { ItemType.LegendarySword, 0.2f }
};

ItemType droppedItem = ItemDropSystem.GetRandomItem(dropRates);
</code></pre>
<h4 id="敵の出現パターン">敵の出現パターン</h4>
<pre><code class="lang-csharp">public class EnemySpawner : IExpresserComponent
{
    public Vector2 SpawnAreaMin { get; set; }
    public Vector2 SpawnAreaMax { get; set; }
    public List&lt;EnemyType&gt; EnemyTypes { get; set; }
    
    public Vector2 GetRandomSpawnPosition()
    {
        float x = RandomNumberGenerator.Range(SpawnAreaMin.X, SpawnAreaMax.X);
        float y = RandomNumberGenerator.Range(SpawnAreaMin.Y, SpawnAreaMax.Y);
        return new Vector2(x, y);
    }
    
    public EnemyType GetRandomEnemyType()
    {
        int index = RandomNumberGenerator.GetValue(EnemyTypes.Count);
        return EnemyTypes[index];
    }
    
    public bool Execute(Object object__, in Time current_time)
    {
        if (ShouldSpawnEnemy())
        {
            var position = GetRandomSpawnPosition();
            var enemyType = GetRandomEnemyType();
            SpawnEnemy(enemyType, position);
        }
        return true;
    }
}
</code></pre>
<h3 id="プロシージャル生成">プロシージャル生成</h3>
<pre><code class="lang-csharp">public class TerrainGenerator
{
    public static float[,] GenerateHeightMap(int width, int height, int seed)
    {
        RandomNumberGenerator.SetSeedValue(seed);
        var heightMap = new float[width, height];
        
        for (int x = 0; x &lt; width; x++)
        {
            for (int y = 0; y &lt; height; y++)
            {
                // パーリンノイズ風の地形生成
                float noise = GenerateNoise(x, y);
                heightMap[x, y] = noise;
            }
        }
        
        return heightMap;
    }
    
    private static float GenerateNoise(int x, int y)
    {
        // 簡単なノイズ生成の例
        RandomNumberGenerator.SetSeedValue(x * 1000 + y);
        return RandomNumberGenerator.GetValue(1.0f);
    }
}
</code></pre>
<h2 id="重要な仕様">重要な仕様</h2>
<h3 id="範囲の包含関係">範囲の包含関係</h3>
<pre><code class="lang-csharp">// 整数の場合: [min, max) - maxは含まれない
int value = RandomNumberGenerator.Range(1, 6); // 1, 2, 3, 4, 5 のいずれか

// 浮動小数点の場合: [min, max) - maxは含まれない
float value = RandomNumberGenerator.Range(0.0f, 1.0f); // 0.0 &lt;= value &lt; 1.0
</code></pre>
<h3 id="決定論的動作">決定論的動作</h3>
<pre><code class="lang-csharp">// 同じシード値で同じ操作を行うと、同じ結果が得られる
RandomNumberGenerator.SetSeedValue(42);
int a = RandomNumberGenerator.Range(1, 100);
int b = RandomNumberGenerator.Range(1, 100);

RandomNumberGenerator.SetSeedValue(42);
int c = RandomNumberGenerator.Range(1, 100); // c == a
int d = RandomNumberGenerator.Range(1, 100); // d == b
</code></pre>
<h2 id="高度な使用例">高度な使用例</h2>
<h3 id="重み付き確率選択">重み付き確率選択</h3>
<pre><code class="lang-csharp">public static class WeightedRandom
{
    public static T Choose&lt;T&gt;(Dictionary&lt;T, float&gt; weights)
    {
        float totalWeight = weights.Values.Sum();
        float random = RandomNumberGenerator.GetValue(totalWeight);
        
        float cumulative = 0.0f;
        foreach (var kvp in weights)
        {
            cumulative += kvp.Value;
            if (random &lt; cumulative)
            {
                return kvp.Key;
            }
        }
        
        return weights.Keys.First(); // フォールバック
    }
}

// 使用例
var spellWeights = new Dictionary&lt;SpellType, float&gt;
{
    { SpellType.Fireball, 10.0f },
    { SpellType.Lightning, 5.0f },
    { SpellType.Heal, 3.0f },
    { SpellType.Meteor, 1.0f }
};

SpellType selectedSpell = WeightedRandom.Choose(spellWeights);
</code></pre>
<h3 id="ランダムウォーク">ランダムウォーク</h3>
<pre><code class="lang-csharp">public class RandomWalkMovement : IExpresserComponent
{
    public float WalkSpeed { get; set; } = 50.0f;
    public float DirectionChangeInterval { get; set; } = 2.0f;
    
    private float currentDirection;
    private float timeSinceDirectionChange;
    
    public bool SetUp(Object object__)
    {
        currentDirection = RandomNumberGenerator.GetValue(360.0f);
        return true;
    }
    
    public bool Execute(Object object__, in Time current_time)
    {
        timeSinceDirectionChange += current_time.DeltaTime;
        
        if (timeSinceDirectionChange &gt;= DirectionChangeInterval)
        {
            // 新しい方向をランダムに選択
            currentDirection = RandomNumberGenerator.GetValue(360.0f);
            timeSinceDirectionChange = 0.0f;
        }
        
        // 移動
        var position = object__.GetExpresserComponent&lt;HasPosition&gt;();
        var radians = currentDirection * Math.PI / 180.0f;
        
        position.X += Math.Cos(radians) * WalkSpeed * current_time.DeltaTime;
        position.Y += Math.Sin(radians) * WalkSpeed * current_time.DeltaTime;
        
        return true;
    }
}
</code></pre>
<h2 id="パフォーマンス考慮事項">パフォーマンス考慮事項</h2>
<ul>
<li><strong>高速生成</strong>: System.Randomベースで高速な乱数生成</li>
<li><strong>メモリ効率</strong>: 静的クラスによるメモリ使用量の最小化</li>
<li><strong>スレッドセーフティ</strong>: シングルスレッド用途を想定（VaNillaの設計思想に準拠）</li>
</ul>
<h2 id="デバッグテスト支援">デバッグ・テスト支援</h2>
<h3 id="乱数シードの管理">乱数シードの管理</h3>
<pre><code class="lang-csharp">public static class RandomSeedManager
{
    private static int currentSeed;
    
    public static void SetDebugSeed(int seed)
    {
        currentSeed = seed;
        RandomNumberGenerator.SetSeedValue(seed);
        Logger.Log($&quot;Random seed set to: {seed}&quot;);
    }
    
    public static int GetCurrentSeed() =&gt; currentSeed;
    
    public static void SetRandomSeed()
    {
        int seed = (int)DateTime.Now.Ticks;
        SetDebugSeed(seed);
    }
}
</code></pre>
<h3 id="テスト用ユーティリティ">テスト用ユーティリティ</h3>
<pre><code class="lang-csharp">#if DEBUG
public static class RandomTestHelper
{
    public static void TestDistribution(int sampleCount = 10000)
    {
        var histogram = new int[10];
        
        for (int i = 0; i &lt; sampleCount; i++)
        {
            int value = RandomNumberGenerator.Range(0, 10);
            histogram[value]++;
        }
        
        Logger.Log(&quot;Random distribution test:&quot;);
        for (int i = 0; i &lt; 10; i++)
        {
            float percentage = (float)histogram[i] / sampleCount * 100;
            Logger.Log($&quot;  {i}: {histogram[i]} ({percentage:F1}%)&quot;);
        }
    }
}
#endif
</code></pre>
<h2 id="設定例yaml">設定例（YAML）</h2>
<pre><code class="lang-yaml">random_number_generator:
  default_seed: 42
  debug_mode: false
  
  # テスト用設定
  test_settings:
    distribution_samples: 10000
    enable_seed_logging: true
    
  # ゲーム固有設定
  game_settings:
    damage_variance: 0.15
    drop_rate_precision: 0.001
    spawn_randomness: 1.0
</code></pre>
<h2 id="注意事項">注意事項</h2>
<h3 id="範囲指定の注意">範囲指定の注意</h3>
<ul>
<li><strong>整数範囲</strong>: <code>Range(1, 6)</code>は1〜5を返す（6は含まれない）</li>
<li><strong>浮動小数点範囲</strong>: <code>Range(0.0f, 1.0f)</code>は0.0以上1.0未満を返す</li>
</ul>
<h3 id="決定論的動作の重要性">決定論的動作の重要性</h3>
<ul>
<li>ゲームのリプレイ機能やネットワーク同期で重要</li>
<li>デバッグ時の再現性確保に不可欠</li>
<li>プロシージャル生成の一貫性保証</li>
</ul>
<h2 id="依存関係">依存関係</h2>
<ul>
<li><a href="../MathUtil/README.html">MathUtil</a> - Math.Range型の使用</li>
<li><strong>System.Random</strong> - .NET標準の乱数生成器</li>
</ul>
<h2 id="関連モジュール">関連モジュール</h2>
<ul>
<li><a href="../MathUtil/README.html">MathUtil</a> - 数学計算ユーティリティ</li>
<li><a href="../Movement/README.html">Movement</a> - ランダム移動パターン</li>
<li><a href="../ObjectFactory/README.html">ObjectFactory</a> - ランダムオブジェクト生成</li>
</ul>
<p>このモジュールにより、ゲーム開発で必要な様々な乱数処理を一貫性をもって効率的に実装できます。</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/EndlessShirafu/VaNilla/blob/develop/Documents/docfx/modules/RandomNumberGenerator/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>

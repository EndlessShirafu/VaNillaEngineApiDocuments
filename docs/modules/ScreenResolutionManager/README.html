<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>ScreenResolutionManager </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="ScreenResolutionManager ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/EndlessShirafu/VaNilla/blob/develop/Documents/docfx/modules/ScreenResolutionManager/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="screenresolutionmanager">ScreenResolutionManager</h1>

<p>ゲームアプリケーションの画面解像度を統一的に管理するためのモジュールです。
VaNillaエンジンにおける解像度設定、アスペクト比管理、スケーリング計算の中核を担い、
DxLibとUnityの両プラットフォームで一貫した解像度管理を提供します。</p>
<h2 id="概要">概要</h2>
<p>ScreenResolutionManagerは、ゲーム開発において重要な画面解像度の管理を効率化するモジュールです。
複数の解像度設定をYAML設定から自動生成し、実行時の解像度変更、座標計算、
UI配置などを簡単に行えるAPIを提供します。</p>
<h2 id="主要機能">主要機能</h2>
<h3 id="解像度管理システム">解像度管理システム</h3>
<table>
<thead>
<tr>
<th>機能</th>
<th>説明</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>解像度設定</strong></td>
<td>複数解像度の一元管理</td>
<td>フルHD、4K、ウルトラワイドなど</td>
</tr>
<tr>
<td><strong>アスペクト比管理</strong></td>
<td>16:9、4:3、21:9対応</td>
<td>UI配置、レターボックス処理</td>
</tr>
<tr>
<td><strong>座標計算</strong></td>
<td>中央座標、境界値の自動計算</td>
<td>オブジェクト配置、カメラ設定</td>
</tr>
<tr>
<td><strong>ビューポート管理</strong></td>
<td>描画領域の統一管理</td>
<td>テクスチャ、レンダリング</td>
</tr>
</tbody>
</table>
<h3 id="yaml駆動コード生成">YAML駆動コード生成</h3>
<p>ScreenResolutionManagerは、YAML設定ファイルから解像度定義を自動生成します：</p>
<pre><code class="lang-yaml"># VaNillaSettings.yaml
screen_resolution:
  - [[1280, 720], [16, 9]]
  - [[1920, 1080], [16, 9]]
  - [[3840, 2160], [16, 9]]
  - [[1600, 900], [16, 9]]
  - [[1024, 768], [4, 3]]

viewport_resolution: [1280, 720]
</code></pre>
<p><strong>⚠️ 重要:</strong> YAML設定を変更した場合は、必ず以下のコマンドでコード生成を実行してください：</p>
<pre><code class="lang-bash">python VaNillaEngineManager/CodeGenerator.py -s [settings_yaml_path]
</code></pre>
<h2 id="基本的な使用方法">基本的な使用方法</h2>
<h3 id="解像度の設定と取得">解像度の設定と取得</h3>
<pre><code class="lang-csharp">using VaNilla;

// 現在の解像度を取得
var currentRes = ScreenResolutionManager.GetCurrentResolution();
Console.WriteLine($&quot;現在の解像度: {currentRes}&quot;);

// 解像度を変更
ScreenResolutionManager.SetCurrentResolution(ScreenResolutionManager.ScreenResolution.RES_1920x1080);

// 実際のサイズを取得
var (width, height) = ScreenResolutionManager.GetCurrentResolutionSize();
Console.WriteLine($&quot;画面サイズ: {width}x{height}&quot;);

// アスペクト比を取得
var (aspectW, aspectH) = ScreenResolutionManager.GetAspectRatio(currentRes);
Console.WriteLine($&quot;アスペクト比: {aspectW}:{aspectH}&quot;);
</code></pre>
<h3 id="座標とレイアウト計算">座標とレイアウト計算</h3>
<pre><code class="lang-csharp">// 画面中央の座標を取得
var (centerX, centerY) = ScreenResolutionManager.Center;
var centerPoint = ScreenResolutionManager.CenterPoint;

// 画面サイズの取得（複数の方法）
int screenWidth = ScreenResolutionManager.CurrentWidth;
int screenHeight = ScreenResolutionManager.CurrentHeight;

// Point2形式での取得
var resolutionPoint = ScreenResolutionManager.CurrentResolutionPoint;

// UI要素の配置例
public void PlaceUIElements()
{
    var center = ScreenResolutionManager.CenterPoint;
    var screenSize = ScreenResolutionManager.CurrentResolutionPoint;
    
    // タイトルロゴを画面中央上部に配置
    var titlePosition = new Point2(center.X, screenSize.Y * 0.25f);
    
    // メニューボタンを画面中央に配置
    var menuPosition = new Point2(center.X, center.Y);
    
    // ステータスバーを画面上部に配置
    var statusBarPosition = new Point2(0, screenSize.Y - 50);
}
</code></pre>
<h3 id="ビューポートとレンダリング">ビューポートとレンダリング</h3>
<pre><code class="lang-csharp">// ビューポート解像度の取得（テクスチャ計算用）
var (viewportW, viewportH) = ScreenResolutionManager.GetViewportResolution();

// カメラのセットアップ
public void SetupCamera()
{
    var resolution = ScreenResolutionManager.GetCurrentResolutionSize();
    var aspectRatio = (float)resolution.Width / resolution.Height;
    
    // カメラの視野角をアスペクト比に応じて調整
    camera.SetAspectRatio(aspectRatio);
    camera.SetViewport(0, 0, resolution.Width, resolution.Height);
}

// テクスチャのスケーリング
public Point2 ScaleTextureToScreen(Point2 textureSize)
{
    var screenSize = ScreenResolutionManager.CurrentResolutionPoint;
    var scaleX = screenSize.X / 1920.0f; // 基準解像度からのスケール
    var scaleY = screenSize.Y / 1080.0f;
    
    return new Point2(
        textureSize.X * scaleX,
        textureSize.Y * scaleY
    );
}
</code></pre>
<h2 id="高度な使用例">高度な使用例</h2>
<h3 id="解像度変更システム">解像度変更システム</h3>
<pre><code class="lang-csharp">public class ResolutionSelector
{
    private static readonly ScreenResolutionManager.ScreenResolution[] SupportedResolutions = 
    {
        ScreenResolutionManager.ScreenResolution.RES_1280x720,
        ScreenResolutionManager.ScreenResolution.RES_1920x1080,
        ScreenResolutionManager.ScreenResolution.RES_2560x1440,
        ScreenResolutionManager.ScreenResolution.RES_3840x2160
    };

    public static void CycleResolution()
    {
        var current = ScreenResolutionManager.GetCurrentResolution();
        var currentIndex = Array.IndexOf(SupportedResolutions, current);
        var nextIndex = (currentIndex + 1) % SupportedResolutions.Length;
        
        var newResolution = SupportedResolutions[nextIndex];
        ScreenResolutionManager.SetCurrentResolution(newResolution);
        
        // プラットフォーム固有の解像度変更処理
        ApplyResolutionChange(newResolution);
        
        VaNilla.Debug.Logger.Log($&quot;解像度を変更: {newResolution}&quot;);
    }

    private static void ApplyResolutionChange(ScreenResolutionManager.ScreenResolution resolution)
    {
        var size = ScreenResolutionManager.GetResolutionSize(resolution);
        
        #if UNITY_ENGINE
            Screen.SetResolution(size.Width, size.Height, Screen.fullScreen);
        #elif DXLIB
            DxLib.SetGraphMode(size.Width, size.Height, 32);
        #endif
    }
}
</code></pre>
<h3 id="レスポンシブui-システム">レスポンシブUI システム</h3>
<pre><code class="lang-csharp">public class ResponsiveUIManager
{
    public enum UIScale { Small, Medium, Large, ExtraLarge }
    
    public static UIScale GetUIScale()
    {
        var resolution = ScreenResolutionManager.GetCurrentResolutionSize();
        var totalPixels = resolution.Width * resolution.Height;
        
        return totalPixels switch
        {
            &lt; 1000000 =&gt; UIScale.Small,      // 720p未満
            &lt; 2000000 =&gt; UIScale.Medium,     // 1080p未満
            &lt; 4000000 =&gt; UIScale.Large,      // 1440p未満
            _ =&gt; UIScale.ExtraLarge          // 4K以上
        };
    }
    
    public static float GetScaleFactor()
    {
        return GetUIScale() switch
        {
            UIScale.Small =&gt; 0.8f,
            UIScale.Medium =&gt; 1.0f,
            UIScale.Large =&gt; 1.25f,
            UIScale.ExtraLarge =&gt; 1.5f,
            _ =&gt; 1.0f
        };
    }
    
    public static Point2 ScaleUIElement(Point2 baseSize)
    {
        var scale = GetScaleFactor();
        return new Point2(baseSize.X * scale, baseSize.Y * scale);
    }
}
</code></pre>
<h3 id="アスペクト比対応システム">アスペクト比対応システム</h3>
<pre><code class="lang-csharp">public class AspectRatioManager
{
    public static (float Width, float Height) GetLetterboxSize()
    {
        var resolution = ScreenResolutionManager.GetCurrentResolutionSize();
        var aspectRatio = ScreenResolutionManager.GetAspectRatio(
            ScreenResolutionManager.GetCurrentResolution());
        
        var targetAspect = (float)aspectRatio.Width / aspectRatio.Height;
        var currentAspect = (float)resolution.Width / resolution.Height;
        
        if (currentAspect &gt; targetAspect)
        {
            // 横に余白（ピラーボックス）
            var scaledWidth = resolution.Height * targetAspect;
            var letterboxWidth = (resolution.Width - scaledWidth) / 2;
            return (letterboxWidth, 0);
        }
        else
        {
            // 縦に余白（レターボックス）
            var scaledHeight = resolution.Width / targetAspect;
            var letterboxHeight = (resolution.Height - scaledHeight) / 2;
            return (0, letterboxHeight);
        }
    }
    
    public static Rectangle GetRenderArea()
    {
        var resolution = ScreenResolutionManager.GetCurrentResolutionSize();
        var (letterboxW, letterboxH) = GetLetterboxSize();
        
        return new Rectangle(
            (int)letterboxW,
            (int)letterboxH,
            (int)(resolution.Width - letterboxW * 2),
            (int)(resolution.Height - letterboxH * 2)
        );
    }
}
</code></pre>
<h3 id="マルチモニター対応">マルチモニター対応</h3>
<pre><code class="lang-csharp">public class MultiMonitorManager
{
    public static void PositionWindowOnMonitor(int monitorIndex)
    {
        var resolution = ScreenResolutionManager.GetCurrentResolutionSize();
        
        #if UNITY_ENGINE
            var displays = Display.displays;
            if (monitorIndex &lt; displays.Length)
            {
                displays[monitorIndex].Activate(resolution.Width, resolution.Height, 60);
            }
        #elif DXLIB
            // DxLibでのマルチモニター処理
            var monitorRect = GetMonitorRect(monitorIndex);
            SetWindowPosition(monitorRect.X, monitorRect.Y);
        #endif
    }
    
    public static List&lt;(int Width, int Height)&gt; GetAvailableMonitorResolutions()
    {
        var resolutions = new List&lt;(int, int)&gt;();
        
        #if UNITY_ENGINE
            foreach (var resolution in Screen.resolutions)
            {
                resolutions.Add((resolution.width, resolution.height));
            }
        #elif DXLIB
            // DxLibでの利用可能解像度取得
            for (int i = 0; i &lt; GetDisplayModeNum(); i++)
            {
                GetDisplayMode(i, out int width, out int height, out int colorBitDepth);
                resolutions.Add((width, height));
            }
        #endif
        
        return resolutions.Distinct().ToList();
    }
}
</code></pre>
<h2 id="設定例">設定例</h2>
<h3 id="一般的なゲーム設定">一般的なゲーム設定</h3>
<pre><code class="lang-yaml"># VaNillaSettings.yaml
# 標準的な16:9解像度設定
screen_resolution:
  - [[1280, 720], [16, 9]]    # HD
  - [[1920, 1080], [16, 9]]   # FullHD
  - [[2560, 1440], [16, 9]]   # QHD
  - [[3840, 2160], [16, 9]]   # 4K

viewport_resolution: [1920, 1080]
</code></pre>
<h3 id="レトロゲーム設定">レトロゲーム設定</h3>
<pre><code class="lang-yaml"># VaNillaSettings.yaml
# クラシックな4:3解像度設定
screen_resolution:
  - [[640, 480], [4, 3]]     # VGA
  - [[800, 600], [4, 3]]     # SVGA
  - [[1024, 768], [4, 3]]    # XGA

viewport_resolution: [640, 480]
</code></pre>
<h3 id="ウルトラワイド対応">ウルトラワイド対応</h3>
<pre><code class="lang-yaml"># VaNillaSettings.yaml
# 21:9ウルトラワイド解像度設定
screen_resolution:
  - [[2560, 1080], [21, 9]]  # UltraWide 1080p
  - [[3440, 1440], [21, 9]]  # UltraWide 1440p

viewport_resolution: [2560, 1080]
</code></pre>
<h2 id="プラットフォーム別考慮事項">プラットフォーム別考慮事項</h2>
<h3 id="unity統合">Unity統合</h3>
<pre><code class="lang-csharp">public class UnityResolutionBridge : MonoBehaviour
{
    void Start()
    {
        // Unityの画面設定をVaNillaと同期
        SyncWithUnityScreen();
    }
    
    void SyncWithUnityScreen()
    {
        var currentRes = ScreenResolutionManager.GetCurrentResolution();
        var size = ScreenResolutionManager.GetResolutionSize(currentRes);
        
        Screen.SetResolution(size.Width, size.Height, Screen.fullScreen);
        
        // カメラのビューポート設定
        Camera.main.aspect = (float)size.Width / size.Height;
    }
    
    public void OnResolutionChanged()
    {
        // 解像度変更時のUI再配置
        var uiElements = FindObjectsOfType&lt;RectTransform&gt;();
        foreach (var element in uiElements)
        {
            RecalculateUIPosition(element);
        }
    }
}
</code></pre>
<h3 id="dxlib統合">DxLib統合</h3>
<pre><code class="lang-csharp">public static class DxLibResolutionBridge
{
    public static void InitializeDxLib()
    {
        var resolution = ScreenResolutionManager.GetCurrentResolutionSize();
        
        // DxLibの初期化
        DxLib.SetGraphMode(resolution.Width, resolution.Height, 32);
        DxLib.ChangeWindowMode(1); // ウィンドウモード
        DxLib.SetBackgroundColor(0, 0, 0);
        
        if (DxLib.DxLib_Init() == -1)
        {
            throw new InvalidOperationException(&quot;DxLibの初期化に失敗しました&quot;);
        }
    }
    
    public static void UpdateResolution()
    {
        var resolution = ScreenResolutionManager.GetCurrentResolutionSize();
        DxLib.SetGraphMode(resolution.Width, resolution.Height, 32);
    }
}
</code></pre>
<h2 id="パフォーマンス最適化">パフォーマンス最適化</h2>
<h3 id="頻繁な解像度取得の最適化">頻繁な解像度取得の最適化</h3>
<pre><code class="lang-csharp">public static class CachedResolutionManager
{
    private static (int Width, int Height) cachedResolution;
    private static ScreenResolutionManager.ScreenResolution lastResolution;
    
    public static (int Width, int Height) GetCachedResolution()
    {
        var current = ScreenResolutionManager.GetCurrentResolution();
        if (current != lastResolution)
        {
            cachedResolution = ScreenResolutionManager.GetCurrentResolutionSize();
            lastResolution = current;
        }
        return cachedResolution;
    }
}
</code></pre>
<h3 id="バッチ座標計算">バッチ座標計算</h3>
<pre><code class="lang-csharp">public static class BatchCoordinateCalculator
{
    public static Point2[] CalculateGridPositions(int columns, int rows, float padding = 10f)
    {
        var resolution = ScreenResolutionManager.CurrentResolutionPoint;
        var positions = new Point2[columns * rows];
        
        var cellWidth = (resolution.X - padding * (columns + 1)) / columns;
        var cellHeight = (resolution.Y - padding * (rows + 1)) / rows;
        
        for (int row = 0; row &lt; rows; row++)
        {
            for (int col = 0; col &lt; columns; col++)
            {
                var index = row * columns + col;
                positions[index] = new Point2(
                    padding + col * (cellWidth + padding) + cellWidth / 2,
                    padding + row * (cellHeight + padding) + cellHeight / 2
                );
            }
        }
        
        return positions;
    }
}
</code></pre>
<h2 id="トラブルシューティング">トラブルシューティング</h2>
<h3 id="よくある問題">よくある問題</h3>
<table>
<thead>
<tr>
<th>問題</th>
<th>原因</th>
<th>解決方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>解像度が反映されない</td>
<td>YAML未更新</td>
<td>CodeGenerator実行</td>
</tr>
<tr>
<td>アスペクト比が崩れる</td>
<td>UI配置の固定値使用</td>
<td>相対座標を使用</td>
</tr>
<tr>
<td>解像度変更時にクラッシュ</td>
<td>プラットフォーム未対応</td>
<td>プラットフォーム別処理追加</td>
</tr>
<tr>
<td>テクスチャがぼやける</td>
<td>スケーリング設定ミス</td>
<td>ビューポート解像度確認</td>
</tr>
</tbody>
</table>
<h3 id="デバッグ支援">デバッグ支援</h3>
<pre><code class="lang-csharp">public static class ResolutionDebugger
{
    public static void LogCurrentSettings()
    {
        var current = ScreenResolutionManager.GetCurrentResolution();
        var size = ScreenResolutionManager.GetCurrentResolutionSize();
        var aspect = ScreenResolutionManager.GetAspectRatio(current);
        var center = ScreenResolutionManager.Center;
        var viewport = ScreenResolutionManager.GetViewportResolution();
        
        VaNilla.Debug.Logger.Log(&quot;=== 解像度設定情報 ===&quot;);
        VaNilla.Debug.Logger.Log($&quot;現在の解像度: {current}&quot;);
        VaNilla.Debug.Logger.Log($&quot;実際のサイズ: {size.Width}x{size.Height}&quot;);
        VaNilla.Debug.Logger.Log($&quot;アスペクト比: {aspect.Width}:{aspect.Height}&quot;);
        VaNilla.Debug.Logger.Log($&quot;画面中央: ({center.X}, {center.Y})&quot;);
        VaNilla.Debug.Logger.Log($&quot;ビューポート: {viewport.Width}x{viewport.Height}&quot;);
    }
    
    public static void ValidateResolutionSettings()
    {
        var current = ScreenResolutionManager.GetCurrentResolution();
        var size = ScreenResolutionManager.GetResolutionSize(current);
        
        if (size.Width &lt;= 0 || size.Height &lt;= 0)
        {
            VaNilla.Debug.Logger.LogError(&quot;無効な解像度が設定されています&quot;);
        }
        
        var aspect = ScreenResolutionManager.GetAspectRatio(current);
        var calculatedAspect = (float)size.Width / size.Height;
        var expectedAspect = (float)aspect.Width / aspect.Height;
        
        if (Math.Abs(calculatedAspect - expectedAspect) &gt; 0.01f)
        {
            VaNilla.Debug.Logger.LogWarning(&quot;アスペクト比の設定に不整合があります&quot;);
        }
    }
}
</code></pre>
<h2 id="技術仕様">技術仕様</h2>
<ul>
<li><strong>解像度管理</strong>: YAML設定ファイルベースの自動生成</li>
<li><strong>座標系</strong>: 左上原点、ピクセル単位</li>
<li><strong>アスペクト比</strong>: 整数比率での定義（16:9、4:3など）</li>
<li><strong>プラットフォーム</strong>: DxLib、Unity両対応</li>
<li><strong>精度</strong>: int型による高精度座標計算</li>
</ul>
<h2 id="依存関係">依存関係</h2>
<ul>
<li><strong>ModuleVersionUtility</strong>: バージョン管理機能</li>
<li><strong>VaNilla.Transform</strong>: Point2座標型</li>
<li><strong>VaNilla.Debug</strong>: ログ出力機能</li>
</ul>
<hr>
<p>ScreenResolutionManagerにより、VaNillaアプリケーションで統一的な解像度管理が実現できます。
YAML駆動のコード生成により、プロジェクト固有の解像度設定を簡単に管理でき、
プラットフォーム間での一貫した動作を保証します。</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/EndlessShirafu/VaNilla/blob/develop/Documents/docfx/modules/ScreenResolutionManager/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
